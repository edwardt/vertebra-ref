<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
  <html>
    <head>
      <title>Example Workflow</title>
      <link rel="stylesheet" href="base.css" type="text/css" media="screen" />
      <link rel="stylesheet" href="workflow.css" type="text/css" media="screen" />
      <script type="text/javascript" src="jquery.js"></script>
      <script type="text/javascript" src="interact.js"></script>
    </head>
    <body>
      <div id="wrap">
      <div id="escapedxml"><div class="pad">
        <h1 class="title">Example Workflow</h1>
        <div class="xmlcontent" style="font-family: Courier, monospace;">
<div><div class="comment indent">&lt;!--<div class="indent">  Example Workflow for Vertebra</div>--&gt;</div></div><div><div class="element hotzone indent" target="workflow">&lt;<span class="tag">workflow</span> <span class="attrkey">name</span>=<span class="attrval">"/sales/accept_order"</span> <span class="attrkey">start</span>=<span class="attrval">"get_data"</span>&gt;<div class="indent">  Sales: Receive Order</div><div class="indent"></div><div class="indent">  Receives an order and gets things rolling.</div><div class="indent"></div><div class="element hotzone indent" target="global,import">&lt;<span class="tag">import</span>&gt;<div class="element hotzone indent" target="type,res,assert">&lt;<span class="tag">res</span> <span class="attrkey">assert</span>=<span class="attrval">"company"</span>&gt;/company/engineyard"&lt;/<span class="tag">res</span>&gt;</div><div class="element hotzone indent" target="type,res,assert">&lt;<span class="tag">res</span> <span class="attrkey">assert</span>=<span class="attrval">"location"</span>&gt;/us&lt;/<span class="tag">res</span>&gt;</div><div class="element hotzone indent" target="type,i4,assert">&lt;<span class="tag">i4</span> <span class="attrkey">assert</span>=<span class="attrval">"api_version"</span>&gt;5&lt;/<span class="tag">i4</span>&gt;</div><div class="indent"></div><div class="element hotzone indent" target="type,string,import_from">&lt;<span class="tag">string</span> <span class="attrkey">from</span>=<span class="attrval">"name"</span>&gt;Id of Customer&lt;/<span class="tag">string</span>&gt;</div><div class="element hotzone indent" target="type,string,import_from">&lt;<span class="tag">string</span> <span class="attrkey">from</span>=<span class="attrval">"location"</span>&gt;Resource Giving Location Information&lt;/<span class="tag">string</span>&gt;</div><div class="element hotzone indent" target="type,list,import_from">&lt;<span class="tag">list</span> <span class="attrkey">from</span>=<span class="attrval">"items"</span>&gt;Line Items Ordered&lt;/<span class="tag">list</span>&gt;</div><div class="indent"></div><div class="element hotzone indent" target="type,i4,stuffed">&lt;<span class="tag">i4</span> <span class="attrkey">key</span>=<span class="attrval">"lucky_number"</span>&gt;42&lt;/<span class="tag">i4</span>&gt;</div>&lt;/<span class="tag">import</span>&gt;</div><div class="indent"></div><div class="comment indent">&lt;!-- We don't have any global &lt;export /&gt; tag --&gt;</div><div class="indent"></div><div class="element hotzone indent" target="state">&lt;<span class="tag">state</span> <span class="attrkey">id</span>=<span class="attrval">"get_data"</span>&gt;<div class="indent">    First, we have to load the contact data from our CRM.</div><div class="indent"></div><div class="element hotzone indent" target="op">&lt;<span class="tag">op</span> <span class="attrkey">type</span>=<span class="attrval">"/sales/crm/find_contact_data"</span> <span class="attrkey">scope</span>=<span class="attrval">"single"</span>&gt;<div class="element hotzone indent" target="op_input">&lt;<span class="tag">import</span>&gt;<div class="element indent">&lt;<span class="tag">string</span> <span class="attrkey">key</span>=<span class="attrval">"contact"</span> <span class="attrkey">from</span>=<span class="attrval">"name"</span> /&gt;</div><span class="element">&lt;<span class="tag">string</span> <span class="attrkey">key</span>=<span class="attrval">"type"</span>&gt;customer&lt;/<span class="tag">string</span>&gt;</span><div class="comment indent">&lt;!-- hardcoded value --&gt;</div>&lt;/<span class="tag">import</span>&gt;</div><div class="element hotzone indent" target="op_export">&lt;<span class="tag">export</span>&gt;<div class="element indent">&lt;<span class="tag">first</span> <span class="attrkey">key</span>=<span class="attrval">"contact_id"</span> <span class="attrkey">to</span>=<span class="attrval">"cust_id"</span> /&gt;</div><span class="element">&lt;<span class="tag">bool</span> <span class="attrkey">assert</span>=<span class="attrval">"error"</span>&gt;false&lt;/<span class="tag">bool</span>&gt;</span><div class="comment indent">&lt;!-- asserted output --&gt;</div>&lt;/<span class="tag">export</span>&gt;</div>&lt;/<span class="tag">op</span>&gt;</div><div class="element indent">&lt;<span class="tag">emit</span>&gt;<div class="element indent">&lt;<span class="tag">string</span> <span class="attrkey">key</span>=<span class="attrval">"message"</span>&gt;Located customer data...&lt;/<span class="tag">string</span>&gt;</div><div class="element indent">&lt;<span class="tag">string</span> <span class="attrkey">from</span>=<span class="attrval">"contact_id"</span> /&gt;</div>&lt;/<span class="tag">emit</span>&gt;</div><div class="element indent">&lt;<span class="tag">trans</span>&gt;<div class="element indent">&lt;<span class="tag">state</span>&gt;process_data&lt;/<span class="tag">state</span>&gt;</div>&lt;/<span class="tag">trans</span>&gt;</div>&lt;/<span class="tag">state</span>&gt;</div><div class="indent"></div><div class="element indent">&lt;<span class="tag">state</span> <span class="attrkey">id</span>=<span class="attrval">"process_data"</span>&gt;<div class="indent">    Now we dispatch the order to the CRM. emit some status, and a log.</div><div class="indent"></div><div class="element indent">&lt;<span class="tag">op</span> <span class="attrkey">type</span>=<span class="attrval">"/sales/crm/add_order"</span> <span class="attrkey">scope</span>=<span class="attrval">"single"</span>&gt;<div class="element indent">&lt;<span class="tag">import</span>&gt;<div class="element indent">&lt;<span class="tag">string</span> <span class="attrkey">key</span>=<span class="attrval">"contact_id"</span> <span class="attrkey">from</span>=<span class="attrval">"cust_id"</span> /&gt;</div><span class="element">&lt;<span class="tag">list</span> <span class="attrkey">from</span>=<span class="attrval">"items"</span> /&gt;</span><div class="comment indent">&lt;!-- key defaults to imported key --&gt;</div>&lt;/<span class="tag">import</span>&gt;</div><div class="element indent">&lt;<span class="tag">export</span>&gt;<div class="element indent">&lt;<span class="tag">first</span> <span class="attrkey">key</span>=<span class="attrval">"order_id"</span> /&gt;</div><div class="element indent">&lt;<span class="tag">first</span> <span class="attrkey">key</span>=<span class="attrval">"confirmation_code"</span> <span class="attrkey">to</span>=<span class="attrval">"ccode"</span> /&gt;</div>&lt;/<span class="tag">export</span>&gt;</div>&lt;/<span class="tag">op</span>&gt;</div><div class="element indent">&lt;<span class="tag">emit</span> <span class="attrkey">log_keys</span>=<span class="attrval">"app,location,cust_id,order_id"</span> <span class="attrkey">log_vals</span>=<span class="attrval">"ccode"</span>&gt;<div class="element indent">&lt;<span class="tag">res</span> <span class="attrkey">key</span>=<span class="attrval">"app"</span>&gt;/sales/crm&lt;/<span class="tag">res</span>&gt;</div><div class="element indent">&lt;<span class="tag">string</span> <span class="attrkey">from</span>=<span class="attrval">"cust_id"</span> /&gt;</div><div class="element indent">&lt;<span class="tag">string</span> <span class="attrkey">from</span>=<span class="attrval">"location"</span> /&gt;</div><div class="element indent">&lt;<span class="tag">string</span> <span class="attrkey">from</span>=<span class="attrval">"order_id"</span> /&gt;</div><div class="element indent">&lt;<span class="tag">string</span> <span class="attrkey">from</span>=<span class="attrval">"ccode"</span> /&gt;</div><div class="element indent">&lt;<span class="tag">string</span> <span class="attrkey">key</span>=<span class="attrval">"message"</span>&gt;Order accepted. Finding contacts.&lt;/<span class="tag">string</span>&gt;</div>&lt;/<span class="tag">emit</span>&gt;</div><div class="element indent">&lt;<span class="tag">trans</span>&gt;<div class="element indent">&lt;<span class="tag">state</span>&gt;build-notify-list&lt;/<span class="tag">state</span>&gt;</div>&lt;/<span class="tag">trans</span>&gt;</div>&lt;/<span class="tag">state</span>&gt;</div><div class="indent"></div><div class="element indent">&lt;<span class="tag">state</span> <span class="attrkey">id</span>=<span class="attrval">"build-notify-list"</span>&gt;<div class="indent">    Here, we lookup who needs to be notified.</div><div class="indent"></div><div class="element indent">&lt;<span class="tag">op</span> <span class="attrkey">type</span>=<span class="attrval">"/data/lookup"</span> <span class="attrkey">scope</span>=<span class="attrval">"all"</span>&gt;<div class="element indent">&lt;<span class="tag">import</span>&gt;<div class="element indent">&lt;<span class="tag">res</span> <span class="attrkey">key</span>=<span class="attrval">"list"</span>&gt;/notify/orders&lt;/<span class="tag">res</span>&gt;</div><div class="element indent">&lt;<span class="tag">string</span> <span class="attrkey">key</span>=<span class="attrval">"customer"</span> <span class="attrkey">from</span>=<span class="attrval">"cust_id"</span> /&gt;</div>&lt;/<span class="tag">import</span>&gt;</div><div class="indent"></div><div class="element indent">&lt;<span class="tag">export</span>&gt;<div class="comment indent">&lt;!-- Here we actually concatenate multiple lists --&gt;</div><div class="element indent">&lt;<span class="tag">list</span> <span class="attrkey">extend</span>=<span class="attrval">"contacts"</span>&gt;<span class="element">&lt;<span class="tag">email</span>&gt;bob@bob.com&lt;/<span class="tag">email</span>&gt;</span>&lt;/<span class="tag">list</span>&gt;</div>&lt;/<span class="tag">export</span>&gt;</div>&lt;/<span class="tag">op</span>&gt;</div><div class="indent"></div><div class="element indent">&lt;<span class="tag">op</span> <span class="attrkey">type</span>=<span class="attrval">"/data/lookup"</span> <span class="attrkey">scope</span>=<span class="attrval">"all"</span>&gt;<div class="comment indent">&lt;!-- This op runs in parallel --&gt;</div><div class="element indent">&lt;<span class="tag">import</span>&gt;<div class="element indent">&lt;<span class="tag">res</span> <span class="attrkey">key</span>=<span class="attrval">"list"</span>&gt;/notify/orders&lt;/<span class="tag">res</span>&gt;</div><div class="element indent">&lt;<span class="tag">res</span> <span class="attrkey">key</span>=<span class="attrval">"department"</span>&gt;/sales&lt;/<span class="tag">res</span>&gt;</div><div class="element indent">&lt;<span class="tag">res</span> <span class="attrkey">from</span>=<span class="attrval">"location"</span> /&gt;</div>&lt;/<span class="tag">import</span>&gt;</div><div class="indent"></div><div class="element indent">&lt;<span class="tag">export</span>&gt;<div class="comment indent">&lt;!-- and we keep adding to the same list --&gt;</div><div class="element indent">&lt;<span class="tag">list</span> <span class="attrkey">extend</span>=<span class="attrval">"contacts"</span>&gt;<span class="element">&lt;<span class="tag">email</span> /&gt;</span>&lt;/<span class="tag">list</span>&gt;</div>&lt;/<span class="tag">export</span>&gt;</div>&lt;/<span class="tag">op</span>&gt;</div><div class="indent"></div><div class="element indent">&lt;<span class="tag">emit</span>&gt;<div class="element indent">&lt;<span class="tag">string</span> <span class="attrkey">key</span>=<span class="attrval">"message"</span>&gt;Notifying contacts.&lt;/<span class="tag">string</span>&gt;</div>&lt;/<span class="tag">emit</span>&gt;</div><div class="indent"></div><div class="element indent">&lt;<span class="tag">trans</span>&gt;<div class="element indent">&lt;<span class="tag">state</span>&gt;notify&lt;/<span class="tag">state</span>&gt;</div>&lt;/<span class="tag">trans</span>&gt;</div>&lt;/<span class="tag">state</span>&gt;</div><div class="indent"></div><div class="element indent">&lt;<span class="tag">state</span> <span class="attrkey">id</span>=<span class="attrval">"notify"</span>&gt;<div class="indent">    And we send the notifications.</div><div class="indent"></div><div class="element indent">&lt;<span class="tag">op</span> <span class="attrkey">type</span>=<span class="attrval">"/comms/mailer"</span> <span class="attrkey">scope</span>=<span class="attrval">"single"</span>&gt;<div class="element indent">&lt;<span class="tag">import</span>&gt;<div class="element indent">&lt;<span class="tag">list</span> <span class="attrkey">each</span>=<span class="attrval">"contacts"</span> /&gt;</div><div class="element indent">&lt;<span class="tag">string</span> <span class="attrkey">key</span>=<span class="attrval">"message"</span>&gt;...&lt;/<span class="tag">string</span>&gt;</div>&lt;/<span class="tag">import</span>&gt;</div>&lt;/<span class="tag">op</span>&gt;</div><div class="indent"></div><div class="element indent">&lt;<span class="tag">emit</span>&gt;<div class="element indent">&lt;<span class="tag">string</span> <span class="attrkey">key</span>=<span class="attrval">"Message"</span>&gt;<div class="indent">        Order complete.</div><div class="indent">	.... (some sort of string interpolation potentially) ...</div>&lt;/<span class="tag">string</span>&gt;</div>&lt;/<span class="tag">emit</span>&gt;</div><div class="indent"></div><div class="element indent">&lt;<span class="tag">trans</span>&gt;<div class="element indent">&lt;<span class="tag">done</span> /&gt;</div>&lt;/<span class="tag">trans</span>&gt;</div>&lt;/<span class="tag">state</span>&gt;</div>&lt;/<span class="tag">workflow</span>&gt;</div></div><div><span class="comment">&lt;!-- funny test &amp;gt; --&gt;</span></div>
        </div>
      </div></div>
      <div id="commentaccordian"><div class="pad">
        <div class="commenthdr" id="header"><p>Click title to see all comments.</p><p>Click individual element text to reveal comments limited to a certain location.</p></div>
        <div class="commenthdr" id="toc"><h3 id="toctitle">Contents</h3><ul id="toclist"></ul></div>
        <div class="commentbox" id="comment_workflow">
    <h3 class="tochead">Workflow</h3>
    <p>This is the definition for a Vertebra workflow.  Workflows are executed
by Cavalcade in a fault-tolerant manner.  The top-level 'workflow' element has
a number of attributes as follows:</p>
    <ul>
      <li>name &#8212; the operation that this workflow offers</li>
      <li>start &#8212; the initial state of the workflow</li>
    </ul>
  </div>
        <div class="commentbox" id="comment_global">
    <h3 class="tochead">Global Import</h3>
    <p>This import element specifies all of the inputs, hardcoded values, and
assertions about the operation as a whole.  Essentially, each subelement says
something about the input to the workflow operation.</p>
  </div>
        <div class="commentbox" id="comment_assert">
    <h4 class="tochead">Asserted Values</h4>
    <p>For example, a data value with an "assert" annotation indicates that
this workflow asserts that this value must be present for this workflow to be
triggered.  This is most commonly used to specify that a certain tree of
resources must be matched.  If the actual resource matched is desired, the
"from" annotation may be used on the same element.</p>
  </div>
        <div class="commentbox" id="comment_import_from">
    <h4 class="tochead">Imported Values</h4>
    <p>A "from" annotation indicates that an input should be copied from the
input key with the value of the "from" attribute into an initial state-value
for the workflow.  By default, the key is the same as the one imported from.
If a "to" annotation is specified as well, then the state-value is keyed on the
value of the "to" annotation instead.</p>
  </div>
        <div class="commentbox" id="comment_stuffed">
    <h4 class="tochead">Default Values</h4>
    <p>A value annotated simply with a "key" is imported into the initial
state-hash as a default value.  It need not be present in the operation that
triggers the workflow.</p>
  </div>
        <div class="commentbox" id="comment_type">
    <h3 class="tochead">Data Type</h3>
    <p>Data type tags indicate how a piece of data is to be marshalled.  Beyond
checking the validity of the tag, Cavalcade handles very few data-types
directly, and can't be relied upon to validate the internal structure of an XML
element.  Element types which are not understood are marked as "opaque", while those that are understood are marked "transparent".</p>
  </div>
        <div class="commentbox" id="comment_res">
    <h4 class="tochead">Resource (transparent)</h4>
    <p>This data-type indicates a Vertebra resource.  A full description of
resources is outside the scope of this document.  For the purposes of matching,
a resource or any of its children will match (in the case of an "assert"
annotation).  For the purposes of importing, a resource is either passed
through literally (in the case of a "key" annotation) or the actual resource
matched is passed through (in the case of a "from" annotation).</p>
  </div>
        <div class="commentbox" id="comment_string">
    <h4 class="tochead">String (transparent)</h4>
    <p>The String data-type is simply an embedded unicode string.</p>
  </div>
        <div class="commentbox" id="comment_i4">
    <h4 class="tochead">Integer, 32-bit (transparent)</h4>
    <p>The integer data-type is a 32-bit, signed integer represented as a string of numerical characters.</p>
  </div>
        <div class="commentbox" id="comment_list">
    <h4 class="tochead">List (transparent)</h4>
    <p>A list is simply the list built up of all of the sub-elements, appropriately unmarshalled.</p>
  </div>
        <div class="commentbox" id="comment_struct">
    <h4 class="tochead">Struct (transparent)</h4>
    <p>A struct is simply the hash built up of all of the sub-elements, appropriately unmarshalled, and keyed by their "key" attribute".</p>
  </div>
      </div></div>
    </div>
  </body>
</html>
